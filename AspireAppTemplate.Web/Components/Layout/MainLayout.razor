@using AspireAppTemplate.Web.Infrastructure.Services
@inherits LayoutComponentBase
@layout BaseLayout
@inject LayoutService LayoutService

<MudDrawer @bind-Open="LayoutService.UserPreferences.IsDrawerOpen" 
           Variant="DrawerVariant.Mini"
           Breakpoint="Breakpoint.None"
           ClipMode="DrawerClipMode.Never" 
           Elevation="0"
           Fixed="true"
           Class="mud-elevation-0 border-right">
    <MudDrawerHeader Class="pa-2 d-flex align-center">
        @* 將收合按鈕移至此處 *@
        <MudIconButton Icon="@Icons.Material.Filled.Menu" 
                       Color="Color.Inherit" 
                       OnClick="@(() => LayoutService.ToggleDrawerAsync())" 
                       Class="mr-1"/>
                       
        @if (LayoutService.UserPreferences.IsDrawerOpen)
        {
            <MudIcon Icon="@Icons.Custom.Brands.MudBlazor" Color="Color.Primary" Size="Size.Large" />
            <MudText Typo="Typo.h6" Class="ml-2 fw-bold">Aspire App</MudText>
        }
    </MudDrawerHeader>
    <NavMenu />
</MudDrawer>

<MudAppBar Elevation="0" Color="Color.Surface" Fixed="true" Class="border-bottom">
    @* AppBar 開頭現在不需要轉向按鈕，因為它在 Drawer 裡 *@
    <MudSpacer />
    
    @* 主題切換按鈕 *@
    <MudTooltip Text="@(LayoutService.UserPreferences.IsDarkMode ? "淺色模式" : "深色模式")">
        <MudIconButton Icon="@(LayoutService.UserPreferences.IsDarkMode ? Icons.Material.Filled.LightMode : Icons.Material.Filled.DarkMode)"
                       Color="Color.Inherit" OnClick="@(() => LayoutService.ToggleDarkModeAsync())" />
    </MudTooltip>
    
    @* 主題設定按鈕 *@
    <MudTooltip Text="主題設定">
        <MudIconButton Icon="@Icons.Material.Filled.Palette" Color="Color.Inherit" OnClick="@(() => LayoutService.ThemeDrawerOpen = true)" />
    </MudTooltip>

    <LoginDisplay />
</MudAppBar>

<MudMainContent>
    <MudContainer MaxWidth="MaxWidth.Large" Class="my-4">
        @Body
    </MudContainer>
</MudMainContent>

@code {
}

<style>
    .border-right {
        border-right: 1px solid var(--mud-palette-lines-default) !important;
    }
    .border-bottom {
        border-bottom: 1px solid var(--mud-palette-lines-default) !important;
    }
</style>
