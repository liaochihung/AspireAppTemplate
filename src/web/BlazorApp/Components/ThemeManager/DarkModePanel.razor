<MudExpansionPanel HideIcon="true">
    <TitleContent>
        <div class="d-flex" style="align-items: center;">
            @if (_isDarkMode)
            {
                <MudText Class="mt-1">切換為淺色模式</MudText>
            }
            else
            {
                <MudText Class="mt-1">切換為深色模式</MudText>
            }
            <MudToggleIconButton @bind-Toggled="_isDarkMode" Icon="@Icons.Material.Filled.WbSunny"
                Color="@Color.Warning" title="off" Class="d-flex ml-auto" ToggledIcon="@Icons.Material.Filled.DarkMode"
                ToggledColor="@Color.Surface" toggledtitle="on" style="left:8px!important" @onclick="@ToggleDarkMode" />
        </div>
    </TitleContent>
</MudExpansionPanel>

@code {
    private bool _isDarkMode;

    [Inject]
    private AspireAppTemplate.Web.Infrastructure.Services.LayoutService LayoutService { get; set; } = default!;

    [Parameter]
    public EventCallback<bool> OnIconClicked { get; set; }

    protected override async Task OnInitializedAsync()
    {
        var prefs = await LayoutService.GetPreferenceAsync();
        _isDarkMode = prefs.IsDarkMode;
    }

    private async Task ToggleDarkMode()
    {
        _isDarkMode = !_isDarkMode;
        await OnIconClicked.InvokeAsync(_isDarkMode);
    }
}
