@page "/token"
@using Microsoft.AspNetCore.Authentication
@using Microsoft.AspNetCore.Components.Authorization
@inject IHttpContextAccessor httpContextAccessor
@inject ISnackbar Snackbar
@inject IJSRuntime JS

<MudText Typo="Typo.h4" GutterBottom="true">Access Token</MudText>

<MudPaper Class="pa-4" MaxWidth="800px" Elevation="1">
    <AuthorizeView>
        <Authorized>
            <MudText Typo="Typo.body1" Class="mb-3">Your current access token is:</MudText>
            @if (isLoading)
            {
                <MudProgressCircular Color="Color.Primary" Indeterminate="true" Size="Size.Small" />
            }
            else if (!string.IsNullOrEmpty(errorMessage))
            {
                <MudAlert Severity="Severity.Error">@errorMessage</MudAlert>
            }
            else if (!string.IsNullOrEmpty(currentToken))
            {
                <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2" Class="mb-2">
                    <MudButton Variant="Variant.Outlined" Size="Size.Small" StartIcon="@Icons.Material.Filled.ContentCopy" OnClick="CopyToken">
                        Copy
                    </MudButton>
                    <MudText Typo="Typo.caption" Class="mud-text-secondary">Token length: @currentToken.Length</MudText>
                </MudStack>
                <MudPaper Class="pa-2 overflow-auto" Style="max-height: 300px;" Outlined="true">
                    <pre style="white-space: pre-wrap; word-break: break-all; font-size: 0.9rem; margin: 0;">@currentToken</pre>
                </MudPaper>
            }
        </Authorized>
        <NotAuthorized>
            <MudAlert Severity="Severity.Info">
                Please <MudLink Href="authentication/login">log in</MudLink> to view your access token.
            </MudAlert>
        </NotAuthorized>
    </AuthorizeView>
</MudPaper>


