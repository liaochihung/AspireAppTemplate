@page "/admin/users"
@attribute [Authorize(Policy = AppPolicies.CanManageProducts)]
@using AspireAppTemplate.Web
@using AspireAppTemplate.Shared
@using Microsoft.AspNetCore.Authorization
@inject IdentityApiClient IdentityClient
@inject IDialogService DialogService
@inject ISnackbar Snackbar

<MudText Typo="Typo.h5" GutterBottom="true">使用者管理</MudText>

<MudButton Variant="Variant.Filled" Color="Color.Primary" StartIcon="@Icons.Material.Filled.Add" OnClick="@(() => OpenUserDialog())" Class="mb-4">新增使用者</MudButton>

<MudDataGrid Items="@_users" Loading="@_loading" Filterable="true">
    <Columns>
        <PropertyColumn Property="x => x.Username" Title="使用者名稱" />
        <PropertyColumn Property="x => x.Email" Title="Email" />
        <PropertyColumn Property="x => x.FirstName" Title="名" />
        <PropertyColumn Property="x => x.LastName" Title="姓" />
        <PropertyColumn Property="x => x.Enabled" Title="啟用" />
        <TemplateColumn CellClass="d-flex justify-end">
            <CellTemplate>
                 <MudIconButton Icon="@Icons.Material.Filled.Assignment" Color="Color.Secondary" OnClick="@(() => ManageRoles(context.Item))" Title="分配角色" />
                 <MudIconButton Icon="@Icons.Material.Filled.Edit" Color="Color.Primary" OnClick="@(() => OpenUserDialog(context.Item))" Title="編輯使用者" />
                 <MudIconButton Icon="@Icons.Material.Filled.Delete" Color="Color.Error" OnClick="@(() => DeleteUser(context.Item))" Title="刪除使用者" />
            </CellTemplate>
        </TemplateColumn>
    </Columns>
</MudDataGrid>


